library(arrow)
install.packages('arrow')
library(arrow)
?write_parquet
(7.5+8.5+6.5+6)/4
(7.5+8.5+6.5+6.5)/4
2/300
pacman::p_load(
arrow, dplyr, ggplot2, data.table, broom, splines, purrr)
cco_pm = arrow::read_parquet(
'Data/cco_synthetic.parquet')
cco_pm
pm_cols = cco_pm %>%
select(starts_with('PM2.5'))
pm_cols = cco_pm %>%
select(starts_with('PM2.5')) %>%
names()
pm_cols
fit_cco = map_dfr(
pm_cols,
fit_clogit,
data = cco_pm)
fit_clogit = function(x, tm_RH_lag = 'MA_07', data = cco_pm){
print(glue::glue('\n----------{x}; {tm_RH_lag}----------\n'))
iqr_x = IQR(data[[x]], na.rm = TRUE)
clean_fit = clogit(
formula = as.formula(paste0("case ~ ",
x,
' + ns(Temperature_',
tm_RH_lag,
', df = 5) + ns(RH_',
tm_RH_lag,
', df = 5)',
' + strata(id)')),
data = data) %>%
broom::tidy() %>%
mutate(OR = exp(estimate*iqr_x), 3,
OR_round = round(exp(estimate*iqr_x), 3),
CI_low = exp(estimate*iqr_x - 1.96*std.error*iqr_x),
CI_high = exp(estimate*iqr_x + 1.96*std.error*iqr_x),
CI_low_round = round(exp(estimate*iqr_x - 1.96*std.error*iqr_x), 3),
CI_high_round = round(exp(estimate*iqr_x + 1.96*std.error*iqr_x), 3),
predictor = x,
iqr = iqr_x,
tm_RH_lag = tm_RH_lag) %>%
mutate(result = paste0(format(OR_round, nsmall = 3),
' (',
format(CI_low_round, nsmall = 3),
'-',
format(CI_high_round, nsmall = 3),
')')) %>%
filter(predictor == term) %>%
mutate(result = gsub('000e\\+00| ', '', result)) %>%
select(predictor, term, iqr, result, OR, CI_low, CI_high, p.value)
return(clean_fit)
}
fit_cco = map_dfr(
pm_cols,
fit_clogit,
data = cco_pm)
pacman::p_load(
arrow, dplyr, ggplot2, data.table, broom, survival, splines, purrr)
fit_cco = map_dfr(
pm_cols,
fit_clogit,
data = cco_pm)
fit_cco
