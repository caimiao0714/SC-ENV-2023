{
  "hash": "82add0b66258a865b71264d667eefddc",
  "result": {
    "markdown": "---\ntitle: \"横截面研究\"\nlinkcolor: '#08519c'\nnavbar: right\n---\n\n\n\n# 文献实例\n\n- **Cai, M.**, Zhang, S., Lin, X., Qian, Z., McMillin, S.E., Yang, Y., Zhang, Z., Pan, J., Lin, H.. (2022) Association of ambient particulate matter pollution of different sizes with in-hospital case fatality among stroke patients in China. ***Neurology.*** ([IF=12.3]{style=\"color:#9A0000;font-weight: bold;\"}) 98(4), e2474-e2486. [PDF {{< fa book-open >}}](https://caimiao0714.github.io/SC-ENV-2023/Papers/2022_1_Neurology_Different_Sizes_PM_Stroke_mortality.pdf)\n\n- **Cai, M.**, Lin, X., Wang, X., Zhang, S., Wang, C., Zhang, Z., Pan, J., Lin, H. (2023). Long-term exposure to ambient fine particulate matter chemical composition and in-hospital case fatality among patients with stroke in China. ***The Lancet Regional Health-Western Pacific*** ([IF=8.6]{style=\"color:#9A0000;font-weight: bold;\"}), 100679. [PDF {{< fa book-open >}}](https://caimiao0714.github.io/SC-ENV-2023/Papers/2023_1_LRHWP.pdf)\n\n\n\n# R语言代码实战\n\n## 数据读取\n\n\n::: {.cell hash='4.cross-sec_cache/html/unnamed-chunk-1_b9622a66b26353c8857d588972aba622'}\n\n```{.r .cell-code}\npacman::p_load(\n  arrow, dplyr, ggplot2, data.table, broom, splines, purrr, tableone, patchwork, latex2exp)\n\ncs_pm = arrow::read_parquet(\n  'Data/cs_synthetic_pm_components.parquet')\n\nglimpse(cs_pm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 30,393\nColumns: 17\n$ inhosp_death      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ age               <int> 61, 68, 69, 74, 71, 52, 74, 72, 77, 66, 60, 73, 60, …\n$ sex               <fct> Female, Female, Male, Male, Female, Male, Male, Male…\n$ ethnicity         <fct> Han, Han, Han, Han, Han, Han, Han, Han, Han, Han, Ha…\n$ occupation        <fct> Farmer, Other, Other, Farmer, Farmer, Other, Farmer,…\n$ marriage          <fct> Married, Married, Married, Married, Married, Other, …\n$ stroke_subtype    <chr> \"Ischemic\", \"Hemorrhagic\", \"Hemorrhagic\", \"Ischemic\"…\n$ hypertension      <dbl> 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1…\n$ diabetes          <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0…\n$ Temperature_MA_07 <dbl> 15.405740, 23.771006, -2.423174, 15.489920, 19.48610…\n$ RH_MA_07          <dbl> 84.76136, 69.86074, 58.37018, 77.01996, 75.38288, 67…\n$ PM2.5_MA_365      <dbl> 25.56762, 53.06090, 40.63659, 49.56892, 29.22137, 52…\n$ SO4_MA_365        <dbl> 5.579043, 8.839439, 6.897126, 10.198819, 6.676281, 9…\n$ NO3_MA_365        <dbl> 4.769624, 12.414940, 8.555672, 11.542473, 4.700461, …\n$ NH4_MA_365        <dbl> 4.067301, 7.929543, 5.920617, 8.340625, 4.216512, 8.…\n$ OM_MA_365         <dbl> 7.401939, 11.583662, 9.617350, 12.414788, 8.576074, …\n$ BC_MA_365         <dbl> 1.634150, 2.142325, 2.070287, 2.311701, 2.003598, 2.…\n```\n:::\n:::\n\n\n## 表1制作\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar_vec = c(\"age\", \"sex\", \"ethnicity\", \"occupation\", \"marriage\", \n\"stroke_subtype\", \"hypertension\", \"diabetes\", \"Temperature_MA_07\", \n\"RH_MA_07\", \"PM2.5_MA_365\", \"SO4_MA_365\", \"NO3_MA_365\", \"NH4_MA_365\", \n\"OM_MA_365\", \"BC_MA_365\")\n\nvar_fct = c(\"sex\", \"ethnicity\", \"occupation\", \"marriage\", \n\"stroke_subtype\", \"hypertension\", \"diabetes\")\n\ntab1 = cs_pm %>% \n  CreateTableOne(\n    vars = var_vec, \n    factorVars = var_fct,\n    strata = 'inhosp_death', \n    addOverall = TRUE) %>% \n  print(formatOptions = list(big.mark = \",\"),\n        missing = TRUE,\n        catDigits = 2,\n        contDigits = 2,\n        showAllLevels = TRUE,\n        printToggle = FALSE) %>% \n    as.data.frame() %>% \n    setDT(x = ., keep.rownames = 'variables') %>% \n    dplyr::select(-test)\n\ntab1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                        variables               level         Overall\n 1:                             n                              30,393\n 2:               age..mean..SD..                        66.39 (7.88)\n 3:                       sex....              Female  13316 (43.81) \n 4:                             X                Male  17077 (56.19) \n 5:                 ethnicity....                 Han  30067 (98.93) \n 6:                           X.1             non-Han    326 ( 1.07) \n 7:                occupation....  Public institution    649 ( 2.14) \n 8:                           X.2 Private institution   1604 ( 5.28) \n 9:                           X.3              Farmer  16603 (54.63) \n10:                           X.4             Jobless    727 ( 2.39) \n11:                           X.5             Retired   3749 (12.34) \n12:                           X.6               Other   7061 (23.23) \n13:                  marriage....             Married  25730 (84.66) \n14:                           X.7           Unmarried    848 ( 2.79) \n15:                           X.8             Widowed   1104 ( 3.63) \n16:                           X.9            Divorced    282 ( 0.93) \n17:                          X.10               Other   2429 ( 7.99) \n18:            stroke_subtype....         Hemorrhagic   7250 (23.85) \n19:                          X.11            Ischemic  21834 (71.84) \n20:                          X.12         Unspecified   1309 ( 4.31) \n21:              hypertension....                   0  14343 (47.19) \n22:                          X.13                   1  16050 (52.81) \n23:                  diabetes....                   0  26129 (85.97) \n24:                          X.14                   1   4264 (14.03) \n25: Temperature_MA_07..mean..SD..                        14.86 (8.99)\n26:          RH_MA_07..mean..SD..                       65.70 (16.23)\n27:      PM2.5_MA_365..mean..SD..                       49.03 (13.13)\n28:        SO4_MA_365..mean..SD..                         8.78 (2.22)\n29:        NO3_MA_365..mean..SD..                        10.68 (2.84)\n30:        NH4_MA_365..mean..SD..                         7.27 (1.74)\n31:         OM_MA_365..mean..SD..                        12.06 (3.12)\n32:         BC_MA_365..mean..SD..                         2.31 (0.63)\n                        variables               level         Overall\n                  0              1      p Missing\n 1:          30,121            272               \n 2:    66.38 (7.87)   67.40 (8.53)  0.034     0.0\n 3:  13213 (43.87)    103 (37.87)   0.054     0.0\n 4:  16908 (56.13)    169 (62.13)                \n 5:  29800 (98.93)    267 (98.16)   0.349     0.0\n 6:    321 ( 1.07)      5 ( 1.84)                \n 7:    647 ( 2.15)      2 ( 0.74)  <0.001     0.0\n 8:   1586 ( 5.27)     18 ( 6.62)                \n 9:  16497 (54.77)    106 (38.97)                \n10:    721 ( 2.39)      6 ( 2.21)                \n11:   3696 (12.27)     53 (19.49)                \n12:   6974 (23.15)     87 (31.99)                \n13:  25514 (84.71)    216 (79.41)  <0.001     0.0\n14:    824 ( 2.74)     24 ( 8.82)                \n15:   1090 ( 3.62)     14 ( 5.15)                \n16:    277 ( 0.92)      5 ( 1.84)                \n17:   2416 ( 8.02)     13 ( 4.78)                \n18:   7086 (23.53)    164 (60.29)  <0.001     0.0\n19:  21746 (72.20)     88 (32.35)                \n20:   1289 ( 4.28)     20 ( 7.35)                \n21:  14206 (47.16)    137 (50.37)   0.321     0.0\n22:  15915 (52.84)    135 (49.63)                \n23:  25910 (86.02)    219 (80.51)   0.012     0.0\n24:   4211 (13.98)     53 (19.49)                \n25:    14.84 (8.99)   16.65 (8.47)  0.001     0.0\n26:   65.66 (16.25)  70.19 (13.59) <0.001     0.0\n27:   49.02 (13.14)  50.28 (12.28)  0.114     0.0\n28:     8.78 (2.22)    9.11 (2.09)  0.014     0.0\n29:    10.68 (2.84)   10.95 (3.00)  0.121     0.0\n30:     7.27 (1.74)    7.45 (1.75)  0.091     0.0\n31:    12.06 (3.13)   12.70 (2.82)  0.001     0.0\n32:     2.31 (0.63)    2.43 (0.55)  0.002     0.0\n                  0              1      p Missing\n```\n:::\n:::\n\n\n清理结果\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab1_v2 = tab1 %>% \n  mutate(variables = gsub('\\\\.\\\\.\\\\.\\\\.', '', variables, perl = TRUE),\n         variables = fifelse(grepl('X\\\\.', variables, perl = TRUE)|\n                                  variables == 'X', '', variables),\n         variables = gsub('\\\\.\\\\.mean\\\\.\\\\.SD\\\\.\\\\.', ', mean (SD)', \n                             variables, perl = TRUE)) \ntab1_v2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       variables               level         Overall\n 1:                            n                              30,393\n 2:               age, mean (SD)                        66.39 (7.88)\n 3:                          sex              Female  13316 (43.81) \n 4:                                             Male  17077 (56.19) \n 5:                    ethnicity                 Han  30067 (98.93) \n 6:                                          non-Han    326 ( 1.07) \n 7:                   occupation  Public institution    649 ( 2.14) \n 8:                              Private institution   1604 ( 5.28) \n 9:                                           Farmer  16603 (54.63) \n10:                                          Jobless    727 ( 2.39) \n11:                                          Retired   3749 (12.34) \n12:                                            Other   7061 (23.23) \n13:                     marriage             Married  25730 (84.66) \n14:                                        Unmarried    848 ( 2.79) \n15:                                          Widowed   1104 ( 3.63) \n16:                                         Divorced    282 ( 0.93) \n17:                                            Other   2429 ( 7.99) \n18:               stroke_subtype         Hemorrhagic   7250 (23.85) \n19:                                         Ischemic  21834 (71.84) \n20:                                      Unspecified   1309 ( 4.31) \n21:                 hypertension                   0  14343 (47.19) \n22:                                                1  16050 (52.81) \n23:                     diabetes                   0  26129 (85.97) \n24:                                                1   4264 (14.03) \n25: Temperature_MA_07, mean (SD)                        14.86 (8.99)\n26:          RH_MA_07, mean (SD)                       65.70 (16.23)\n27:      PM2.5_MA_365, mean (SD)                       49.03 (13.13)\n28:        SO4_MA_365, mean (SD)                         8.78 (2.22)\n29:        NO3_MA_365, mean (SD)                        10.68 (2.84)\n30:        NH4_MA_365, mean (SD)                         7.27 (1.74)\n31:         OM_MA_365, mean (SD)                        12.06 (3.12)\n32:         BC_MA_365, mean (SD)                         2.31 (0.63)\n                       variables               level         Overall\n                  0              1      p Missing\n 1:          30,121            272               \n 2:    66.38 (7.87)   67.40 (8.53)  0.034     0.0\n 3:  13213 (43.87)    103 (37.87)   0.054     0.0\n 4:  16908 (56.13)    169 (62.13)                \n 5:  29800 (98.93)    267 (98.16)   0.349     0.0\n 6:    321 ( 1.07)      5 ( 1.84)                \n 7:    647 ( 2.15)      2 ( 0.74)  <0.001     0.0\n 8:   1586 ( 5.27)     18 ( 6.62)                \n 9:  16497 (54.77)    106 (38.97)                \n10:    721 ( 2.39)      6 ( 2.21)                \n11:   3696 (12.27)     53 (19.49)                \n12:   6974 (23.15)     87 (31.99)                \n13:  25514 (84.71)    216 (79.41)  <0.001     0.0\n14:    824 ( 2.74)     24 ( 8.82)                \n15:   1090 ( 3.62)     14 ( 5.15)                \n16:    277 ( 0.92)      5 ( 1.84)                \n17:   2416 ( 8.02)     13 ( 4.78)                \n18:   7086 (23.53)    164 (60.29)  <0.001     0.0\n19:  21746 (72.20)     88 (32.35)                \n20:   1289 ( 4.28)     20 ( 7.35)                \n21:  14206 (47.16)    137 (50.37)   0.321     0.0\n22:  15915 (52.84)    135 (49.63)                \n23:  25910 (86.02)    219 (80.51)   0.012     0.0\n24:   4211 (13.98)     53 (19.49)                \n25:    14.84 (8.99)   16.65 (8.47)  0.001     0.0\n26:   65.66 (16.25)  70.19 (13.59) <0.001     0.0\n27:   49.02 (13.14)  50.28 (12.28)  0.114     0.0\n28:     8.78 (2.22)    9.11 (2.09)  0.014     0.0\n29:    10.68 (2.84)   10.95 (3.00)  0.121     0.0\n30:     7.27 (1.74)    7.45 (1.75)  0.091     0.0\n31:    12.06 (3.13)   12.70 (2.82)  0.001     0.0\n32:     2.31 (0.63)    2.43 (0.55)  0.002     0.0\n                  0              1      p Missing\n```\n:::\n:::\n\n\n每3位数字加上逗号\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadd_comma = function(x, separator = ','){\n  str_pattern = '(\\\\d+|\\\\d+\\\\.\\\\d+)(\\\\s+\\\\((\\\\s+|)(\\\\d+| \\\\d+)\\\\.\\\\d+\\\\))'\n  d_numb = gsub('^\\\\s+|^\\\\s+$', '', x) %>% \n    gsub(str_pattern, '\\\\1', .) %>% \n    as.numeric() %>% \n    suppressWarnings() %>% \n    scales::label_comma(\n      accuracy = 0.01, \n      decimal.mark = \".\", \n      big.mark = separator)(.)\n  d_perc = gsub(str_pattern, '\\\\2', x)\n  \n  return_vec = ifelse(\n    grepl('(\\\\d+)( \\\\()((\\\\d+| \\\\d+)\\\\.\\\\d+)(\\\\))', x),\n    paste0(d_numb, d_perc) %>% \n      gsub('\\\\.00', '', .) %>% \n      gsub('\\\\s+\\\\(', ' \\\\(', .),\n    x)\n  \n  return(return_vec)\n}\n\ntab1_v3 = tab1_v2 %>% \n  mutate(across(Overall:`1`, add_comma))\n\ntab1_v3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       variables               level         Overall\n 1:                            n                              30,393\n 2:               age, mean (SD)                        66.39 (7.88)\n 3:                          sex              Female 13,316 (43.81) \n 4:                                             Male 17,077 (56.19) \n 5:                    ethnicity                 Han 30,067 (98.93) \n 6:                                          non-Han    326 ( 1.07) \n 7:                   occupation  Public institution    649 ( 2.14) \n 8:                              Private institution  1,604 ( 5.28) \n 9:                                           Farmer 16,603 (54.63) \n10:                                          Jobless    727 ( 2.39) \n11:                                          Retired  3,749 (12.34) \n12:                                            Other  7,061 (23.23) \n13:                     marriage             Married 25,730 (84.66) \n14:                                        Unmarried    848 ( 2.79) \n15:                                          Widowed  1,104 ( 3.63) \n16:                                         Divorced    282 ( 0.93) \n17:                                            Other  2,429 ( 7.99) \n18:               stroke_subtype         Hemorrhagic  7,250 (23.85) \n19:                                         Ischemic 21,834 (71.84) \n20:                                      Unspecified  1,309 ( 4.31) \n21:                 hypertension                   0 14,343 (47.19) \n22:                                                1 16,050 (52.81) \n23:                     diabetes                   0 26,129 (85.97) \n24:                                                1  4,264 (14.03) \n25: Temperature_MA_07, mean (SD)                        14.86 (8.99)\n26:          RH_MA_07, mean (SD)                       65.70 (16.23)\n27:      PM2.5_MA_365, mean (SD)                       49.03 (13.13)\n28:        SO4_MA_365, mean (SD)                         8.78 (2.22)\n29:        NO3_MA_365, mean (SD)                        10.68 (2.84)\n30:        NH4_MA_365, mean (SD)                         7.27 (1.74)\n31:         OM_MA_365, mean (SD)                        12.06 (3.12)\n32:         BC_MA_365, mean (SD)                         2.31 (0.63)\n                       variables               level         Overall\n                  0             1      p Missing\n 1:          30,121           272               \n 2:    66.38 (7.87)  67.40 (8.53)  0.034     0.0\n 3: 13,213 (43.87)   103 (37.87)   0.054     0.0\n 4: 16,908 (56.13)   169 (62.13)                \n 5: 29,800 (98.93)   267 (98.16)   0.349     0.0\n 6:    321 ( 1.07)     5 ( 1.84)                \n 7:    647 ( 2.15)     2 ( 0.74)  <0.001     0.0\n 8:  1,586 ( 5.27)    18 ( 6.62)                \n 9: 16,497 (54.77)   106 (38.97)                \n10:    721 ( 2.39)     6 ( 2.21)                \n11:  3,696 (12.27)    53 (19.49)                \n12:  6,974 (23.15)    87 (31.99)                \n13: 25,514 (84.71)   216 (79.41)  <0.001     0.0\n14:    824 ( 2.74)    24 ( 8.82)                \n15:  1,090 ( 3.62)    14 ( 5.15)                \n16:    277 ( 0.92)     5 ( 1.84)                \n17:  2,416 ( 8.02)    13 ( 4.78)                \n18:  7,086 (23.53)   164 (60.29)  <0.001     0.0\n19: 21,746 (72.20)    88 (32.35)                \n20:  1,289 ( 4.28)    20 ( 7.35)                \n21: 14,206 (47.16)   137 (50.37)   0.321     0.0\n22: 15,915 (52.84)   135 (49.63)                \n23: 25,910 (86.02)   219 (80.51)   0.012     0.0\n24:  4,211 (13.98)    53 (19.49)                \n25:    14.84 (8.99)  16.65 (8.47)  0.001     0.0\n26:   65.66 (16.25) 70.19 (13.59) <0.001     0.0\n27:   49.02 (13.14) 50.28 (12.28)  0.114     0.0\n28:     8.78 (2.22)   9.11 (2.09)  0.014     0.0\n29:    10.68 (2.84)     10.95 (3)  0.121     0.0\n30:     7.27 (1.74)   7.45 (1.75)  0.091     0.0\n31:    12.06 (3.13)  12.70 (2.82)  0.001     0.0\n32:     2.31 (0.63)   2.43 (0.55)  0.002     0.0\n                  0             1      p Missing\n```\n:::\n:::\n\n\n\n写出成excel进行整理\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfwrite(tab1_v3, 'tab1.csv')\ngetwd()\n```\n:::\n\n\n## 逻辑回归\n\n\n::: {.cell hash='4.cross-sec_cache/html/unnamed-chunk-6_1da151ea30148f17e9c1916a82690599'}\n\n```{.r .cell-code}\nfit_logistic = function(x, data = cs_pm, outcome_var = 'inhosp_death'){\n  cat(paste0(x, '\\n'))\n  x_iqr = IQR(data[[x]], na.rm = TRUE)\n  \n  clean_fit = glm(\n    formula = as.formula(paste0(outcome_var, \" ~ \", \n                    x, \n                    ' + age + sex + ethnicity + occupation + marriage + stroke_subtype + \n                    hypertension + diabetes + \n                    ns(Temperature_MA_07 , df = 5) + ns(RH_MA_07, df = 5)')),\n    family = binomial, #Logistic regression设置连接函数\n    data = data) %>% \n    tidy() %>% \n    #filter(grepl('PM|O3|CO|NO2|SO2', term)) %>% \n    mutate(OR = exp(estimate*x_iqr), 3,\n           OR_round = round(exp(estimate*x_iqr), 3),\n           CI_low = exp(estimate*x_iqr - 1.96*std.error*x_iqr),\n           CI_high = exp(estimate*x_iqr + 1.96*std.error*x_iqr),\n           CI_low_round = round(exp(estimate*x_iqr - 1.96*std.error*x_iqr), 3),\n           CI_high_round = round(exp(estimate*x_iqr + 1.96*std.error*x_iqr), 3),\n           predictor = x) %>% \n    mutate(result = paste0(format(OR_round, nsmall = 3), \n                           ' (', \n                           format(CI_low_round, nsmall = 3), \n                           '-', \n                           format(CI_high_round, nsmall = 3),\n                           ')') %>% \n             gsub(' ', '', .) %>% \n             gsub('\\\\(', ' (', .),\n           pollutant_IQR = x_iqr) %>% \n    mutate(result = gsub('000e\\\\+00', '', result)) %>% \n    select(predictor, term, pollutant_IQR, result, OR, CI_low, CI_high, p.value)\n  \n  return(clean_fit)\n}\n\nfit_longterm_365 = purrr::map_df(\n  c(\"PM2.5_MA_365\", \"SO4_MA_365\", \"NO3_MA_365\", \n    \"NH4_MA_365\", \"OM_MA_365\", \"BC_MA_365\"), \n  fit_logistic,\n  data = cs_pm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPM2.5_MA_365\nSO4_MA_365\nNO3_MA_365\nNH4_MA_365\nOM_MA_365\nBC_MA_365\n```\n:::\n\n```{.r .cell-code}\nfit_longterm_365 %>% \n  filter(predictor == term)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  predictor    term         pollutant_IQR result       OR CI_low CI_high p.value\n  <chr>        <chr>                <dbl> <chr>     <dbl>  <dbl>   <dbl>   <dbl>\n1 PM2.5_MA_365 PM2.5_MA_365        15.1   1.142 (0…  1.14  0.978    1.33 0.0939 \n2 SO4_MA_365   SO4_MA_365           2.83  1.172 (0…  1.17  0.997    1.38 0.0551 \n3 NO3_MA_365   NO3_MA_365           3.28  1.133 (0…  1.13  0.972    1.32 0.111  \n4 NH4_MA_365   NH4_MA_365           2.00  1.116 (0…  1.12  0.961    1.30 0.150  \n5 OM_MA_365    OM_MA_365            3.47  1.218 (1…  1.22  1.05     1.41 0.00732\n6 BC_MA_365    BC_MA_365            0.712 1.197 (1…  1.20  1.04     1.38 0.0143 \n```\n:::\n:::\n\n\n\n## 暴露反应关系\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquantile(cs_pm$PM2.5_MA_365, c(0.25, 0.5, 0.75))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     25%      50%      75% \n40.48217 47.54928 55.58546 \n```\n:::\n\n```{.r .cell-code}\nquantile(cs_pm$PM2.5_MA_365, c(0.01, 0.99))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      1%      99% \n21.38067 85.20396 \n```\n:::\n\n```{.r .cell-code}\nfit_pm2.5 = glm(\n  inhosp_death ~ ns(PM2.5_MA_365, knots = c(40.48, 65.54, 75.58)) + \n    age + sex + ethnicity + occupation + marriage + stroke_subtype,\n  family = binomial,\n  data = cs_pm %>% \n    filter(PM2.5_MA_365 > 21.38 & PM2.5_MA_365 < 80)) \n\nsp_pm2.5 = fit_pm2.5 %>%\n  termplot(se = T, plot = F) %>%\n  .[['PM2.5_MA_365']] %>%\n  as.data.table() %>% \n  .[,`:=`(HR = exp(y),\n          HRmin = exp(y - 1.96*se),\n          HRmax = exp(y + 1.96*se))] %>% \n  .[, `:=`(pollutant = 'PM2.5')] %>% \n  .[]\n\nsp_pm2.5\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              x          y        se        HR     HRmin    HRmax pollutant\n    1: 21.38206 -0.1801450 0.4066939 0.8351491 0.3763390 1.853313     PM2.5\n    2: 21.38321 -0.1801495 0.4066593 0.8351453 0.3763627 1.853179     PM2.5\n    3: 21.38823 -0.1801692 0.4065088 0.8351289 0.3764664 1.852596     PM2.5\n    4: 21.39237 -0.1801854 0.4063849 0.8351154 0.3765517 1.852116     PM2.5\n    5: 21.39479 -0.1801949 0.4063122 0.8351074 0.3766018 1.851835     PM2.5\n   ---                                                                     \n29033: 79.90769 -0.4279915 0.7258555 0.6518169 0.1571321 2.703873     PM2.5\n29034: 79.91672 -0.4278512 0.7271430 0.6519084 0.1567581 2.711085     PM2.5\n29035: 79.94468 -0.4274167 0.7311304 0.6521917 0.1556054 2.733544     PM2.5\n29036: 79.97850 -0.4268909 0.7359584 0.6525347 0.1542209 2.760985     PM2.5\n29037: 79.99940 -0.4265660 0.7389445 0.6527468 0.1533707 2.778095     PM2.5\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narr = list('PM1' = TeX(\"PM$_{1}$\"),  \n           \"PM2.5\" = TeX(\"PM$_{2.5}$\"), \n           \"PM10\" = TeX(\"PM$_{10}$\"))\nmylabel = function(val) { return(lapply(val, function(x) arr[x])) }\n\ncolor7 = c('#7570b3', '#d95f02', '#1b9e77')\n\np_pm2.5 = sp_pm2.5 %>% \n  ggplot(aes(x = x, y = HR)) +\n  geom_hline(yintercept = 1, linewidth = 0.8, alpha = 0.6, linetype = 'dashed') +\n  geom_ribbon(aes(ymin = HRmin, ymax = HRmax), alpha = 0.3, color = NA, fill = color7[1]) +\n  geom_line(linewidth = 1.5, color = color7[1]) +\n  facet_wrap(~ pollutant, scales = 'free', labeller = mylabel) +\n  scale_x_continuous(expand = c(0, 0)) +\n  scale_y_continuous(expand = c(0, 0.05)) +\n  labs(x = NULL, y = 'Odds of death') +\n  theme_test(base_size = 20, base_family = 'serif') + # , base_family = 'serif'\n  theme(plot.margin = unit(c(0, 0.5, 0, 0.2), 'cm'),\n        plot.title = element_text(size = 20, face = 'bold'),\n        strip.background = element_rect(fill = ggplot2::alpha(color7[1], 0.3), color = NA),\n        strip.text = element_text(size = 18, face = 'bold'))\n\np_pm2.5\n```\n\n::: {.cell-output-display}\n![](4.cross-sec_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}