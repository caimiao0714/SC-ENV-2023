{
  "hash": "d98265904d6e06480cffe886c07fd248",
  "result": {
    "markdown": "---\ntitle: \"横截面研究\"\nlinkcolor: '#08519c'\nnavbar: right\n---\n\n\n\n# 文献实例\n\n- **Cai, M.**, Zhang, S., Lin, X., Qian, Z., McMillin, S.E., Yang, Y., Zhang, Z., Pan, J., Lin, H.. (2022) Association of ambient particulate matter pollution of different sizes with in-hospital case fatality among stroke patients in China. ***Neurology.*** ([IF=12.3]{style=\"color:#9A0000;font-weight: bold;\"}) 98(4), e2474-e2486. [PDF {{< fa book-open >}}](https://caimiao0714.github.io/SC-ENV-2023/Papers/2022_1_Neurology_Different_Sizes_PM_Stroke_mortality.pdf)\n\n- **Cai, M.**, Lin, X., Wang, X., Zhang, S., Wang, C., Zhang, Z., Pan, J., Lin, H. (2023). Long-term exposure to ambient fine particulate matter chemical composition and in-hospital case fatality among patients with stroke in China. ***The Lancet Regional Health-Western Pacific*** ([IF=8.6]{style=\"color:#9A0000;font-weight: bold;\"}), 100679. [PDF {{< fa book-open >}}](https://caimiao0714.github.io/SC-ENV-2023/Papers/2023_1_LRHWP.pdf)\n\n\n\n# R语言代码实战\n\n## 逻辑回归\n\n\n::: {.cell hash='4.cross-sec_cache/html/unnamed-chunk-1_795089bb605f0905ce4377aed258871a'}\n\n```{.r .cell-code}\npacman::p_load(\n  arrow, dplyr, ggplot2, data.table, broom, splines, purrr)\n\ncs_pm = arrow::read_parquet(\n  'Data/cs_synthetic_pm_components.parquet')\n\nglimpse(cs_pm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 40,000\nColumns: 17\n$ inhosp_death      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0…\n$ age               <dbl> 84.66256, 61.99863, 68.47912, 81.00000, 69.56331, 80…\n$ sex               <fct> Female, Female, Female, Male, Male, Female, Male, Ma…\n$ ethnicity         <fct> Han, Han, Han, Han, Han, Han, Han, Han, Han, Han, Ha…\n$ occupation        <fct> Public institution, Farmer, Other, Farmer, Other, Fa…\n$ marriage          <fct> Married, Married, Married, Married, Married, Married…\n$ stroke_subtype    <chr> \"Ischemic\", \"Ischemic\", \"Hemorrhagic\", \"Ischemic\", \"…\n$ hypertension      <dbl> 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0…\n$ diabetes          <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0…\n$ Temperature_MA_07 <dbl> 15.831496, 15.405740, 23.771006, 17.085323, -2.42317…\n$ RH_MA_07          <dbl> 34.96154, 84.76136, 69.86074, 84.48593, 58.37018, 82…\n$ PM2.5_MA_365      <dbl> 70.77801, 25.56762, 53.06090, 40.77056, 40.63659, 43…\n$ SO4_MA_365        <dbl> 10.823626, 5.579043, 8.839439, 7.744119, 6.897126, 8…\n$ NO3_MA_365        <dbl> 11.528731, 4.769624, 12.414940, 9.982736, 8.555672, …\n$ NH4_MA_365        <dbl> 7.335312, 4.067301, 7.929543, 6.910553, 5.920617, 7.…\n$ OM_MA_365         <dbl> 16.317992, 7.401939, 11.583662, 10.286706, 9.617350,…\n$ BC_MA_365         <dbl> 3.279193, 1.634150, 2.142325, 1.939696, 2.070287, 2.…\n```\n:::\n:::\n\n::: {.cell hash='4.cross-sec_cache/html/unnamed-chunk-2_b981722947a132b0793f319b74c3bfd3'}\n\n```{.r .cell-code}\nfit_logistic = function(x, data = cs_pm, outcome_var = 'inhosp_death'){\n  cat(paste0(x, '\\n'))\n  x_iqr = IQR(data[[x]], na.rm = TRUE)\n  \n  clean_fit = glm(\n    formula = as.formula(paste0(outcome_var, \" ~ \", \n                    x, \n                    ' + age + sex + ethnicity + occupation + marriage + stroke_subtype + \n                    hypertension + diabetes + \n                    ns(Temperature_MA_07 , df = 5) + ns(RH_MA_07, df = 5)')),\n    family = binomial,\n    data = data) %>% \n    tidy() %>% \n    #filter(grepl('PM|O3|CO|NO2|SO2', term)) %>% \n    mutate(OR = exp(estimate*x_iqr), 3,\n           OR_round = round(exp(estimate*x_iqr), 3),\n           CI_low = exp(estimate*x_iqr - 1.96*std.error*x_iqr),\n           CI_high = exp(estimate*x_iqr + 1.96*std.error*x_iqr),\n           CI_low_round = round(exp(estimate*x_iqr - 1.96*std.error*x_iqr), 3),\n           CI_high_round = round(exp(estimate*x_iqr + 1.96*std.error*x_iqr), 3),\n           predictor = x) %>% \n    mutate(result = paste0(format(OR_round, nsmall = 3), \n                           ' (', \n                           format(CI_low_round, nsmall = 3), \n                           '-', \n                           format(CI_high_round, nsmall = 3),\n                           ')') %>% \n             gsub(' ', '', .) %>% \n             gsub('\\\\(', ' (', .),\n           pollutant_IQR = x_iqr) %>% \n    mutate(result = gsub('000e\\\\+00', '', result)) %>% \n    select(predictor, term, pollutant_IQR, result, OR, CI_low, CI_high, p.value) \n  \n  return(clean_fit)\n}\n\nfit_longterm_365 = purrr::map_df(\n  c(\"PM2.5_MA_365\", \"SO4_MA_365\", \"NO3_MA_365\", \n    \"NH4_MA_365\", \"OM_MA_365\", \"BC_MA_365\"), \n  fit_logistic)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPM2.5_MA_365\nSO4_MA_365\nNO3_MA_365\nNH4_MA_365\nOM_MA_365\nBC_MA_365\n```\n:::\n\n```{.r .cell-code}\nfit_longterm_365 %>% \n  filter(grepl('_MA_365', term))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  predictor    term         pollutant_IQR result       OR CI_low CI_high p.value\n  <chr>        <chr>                <dbl> <chr>     <dbl>  <dbl>   <dbl>   <dbl>\n1 PM2.5_MA_365 PM2.5_MA_365        15.1   1.178 (1…  1.18   1.04    1.33 8.49e-3\n2 SO4_MA_365   SO4_MA_365           2.82  1.240 (1…  1.24   1.09    1.41 8.28e-4\n3 NO3_MA_365   NO3_MA_365           3.28  1.175 (1…  1.17   1.04    1.33 9.46e-3\n4 NH4_MA_365   NH4_MA_365           1.99  1.194 (1…  1.19   1.06    1.34 2.98e-3\n5 OM_MA_365    OM_MA_365            3.49  1.245 (1…  1.24   1.11    1.39 1.57e-4\n6 BC_MA_365    BC_MA_365            0.716 1.219 (1…  1.22   1.09    1.36 6.14e-4\n```\n:::\n:::\n\n\n## 亚组分析\n\n\n\n## 暴露反应关系\n\n\n\n## PAF计算\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}