{
  "hash": "02a771bbb86e0fe13f816b6183437e01",
  "result": {
    "markdown": "---\ntitle: \"横截面研究\"\nlinkcolor: '#08519c'\nnavbar: right\n---\n\n\n# 研究设计\n\n\n\n\n\n# 文献实例\n\n\n- **Cai, M.**, Zhang, S., Lin, X., Qian, Z., McMillin, S.E., Yang, Y., Zhang, Z., Pan, J., Lin, H.. (2022) Association of ambient particulate matter pollution of different sizes with in-hospital case fatality among stroke patients in China. ***Neurology.*** ([IF=12.3]{style=\"color:#9A0000;font-weight: bold;\"}) 98(4), e2474-e2486. [PDF {{< fa book-open >}}](https://caimiao0714.github.io/SC-ENV-2023/Papers/2022_1_Neurology_Different_Sizes_PM_Stroke_mortality.pdf)\n\n- **Cai, M.**, Lin, X., Wang, X., Zhang, S., Wang, C., Zhang, Z., Pan, J., Lin, H. (2023). Long-term exposure to ambient fine particulate matter chemical composition and in-hospital case fatality among patients with stroke in China. ***The Lancet Regional Health-Western Pacific*** ([IF=8.6]{style=\"color:#9A0000;font-weight: bold;\"}), 100679. [PDF {{< fa book-open >}}](https://caimiao0714.github.io/SC-ENV-2023/Papers/2023_1_LRHWP.pdf)\n\n\n\n# R语言代码实战\n\n## 横截面研究\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\n  arrow, dplyr, ggplot2, data.table, broom, splines, purrr)\n\ncs_pm = arrow::read_parquet(\n  'Data/cs_synthetic_pm_components.parquet')\ncs_pm\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 50,000 × 19\n   Province inhosp…¹   age sex   ethni…² occup…³ marri…⁴ strok…⁵ hospi…⁶ hyper…⁷\n   <chr>       <dbl> <dbl> <chr> <chr>   <chr>   <chr>   <chr>   <chr>     <dbl>\n 1 Sichuan         0  74.1 Male  Han     Farmer  Married Ischem… Non-Te…       1\n 2 Guangxi         0  81.4 Male  Han     Farmer  Married Hemorr… Non-Te…       0\n 3 Guangxi         1  72.6 Male  Han     Farmer  Married Ischem… Non-Te…       0\n 4 Shanxi          0  72.1 Fema… Han     Retired Married Ischem… Non-Te…       0\n 5 Sichuan         0  51.0 Male  Han     Farmer  Married Ischem… Non-Te…       0\n 6 Shanxi          0  81.9 Male  Han     Farmer  Married Ischem… Non-Te…       1\n 7 Shanxi          0  66.4 Fema… Han     Retired Married Ischem… Tertia…       0\n 8 Sichuan         0  49.1 Fema… Han     Farmer  Married Ischem… Non-Te…       0\n 9 Guangxi         0  59.4 Male  Han     Farmer  Married Hemorr… Non-Te…       0\n10 Sichuan         0  66.2 Male  Han     Farmer  Married Hemorr… Tertia…       1\n# … with 49,990 more rows, 9 more variables: diabetes <dbl>,\n#   Temperature_MA_07 <dbl>, RH_MA_07 <dbl>, PM2.5_MA_365 <dbl>,\n#   SO4_MA_365 <dbl>, NO3_MA_365 <dbl>, NH4_MA_365 <dbl>, OM_MA_365 <dbl>,\n#   BC_MA_365 <dbl>, and abbreviated variable names ¹​inhosp_death, ²​ethnicity,\n#   ³​occupation, ⁴​marriage, ⁵​stroke_subtype, ⁶​hospital_level, ⁷​hypertension\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_logistic = function(x, data = cs_pm, outcome_var = 'inhosp_death'){\n  cat(paste0(x, '\\n'))\n  x_iqr = IQR(data[[x]], na.rm = TRUE)\n  \n  clean_fit = glm(\n    formula = as.formula(paste0(outcome_var, \" ~ \", \n                    x, \n                    ' + age + sex + ethnicity + occupation + marriage + stroke_subtype + \n                    hypertension + diabetes + hospital_level + \n                    ns(Temperature_MA_07 , df = 5) + ns(RH_MA_07, df = 5) + Province')),\n    family = binomial,\n    data = data) %>% \n    tidy() %>% \n    #filter(grepl('PM|O3|CO|NO2|SO2', term)) %>% \n    mutate(OR = exp(estimate*x_iqr), 3,\n           OR_round = round(exp(estimate*x_iqr), 3),\n           CI_low = exp(estimate*x_iqr - 1.96*std.error*x_iqr),\n           CI_high = exp(estimate*x_iqr + 1.96*std.error*x_iqr),\n           CI_low_round = round(exp(estimate*x_iqr - 1.96*std.error*x_iqr), 3),\n           CI_high_round = round(exp(estimate*x_iqr + 1.96*std.error*x_iqr), 3),\n           predictor = x) %>% \n    mutate(result = paste0(format(OR_round, nsmall = 3), \n                           ' (', \n                           format(CI_low_round, nsmall = 3), \n                           '-', \n                           format(CI_high_round, nsmall = 3),\n                           ')') %>% \n             gsub(' ', '', .) %>% \n             gsub('\\\\(', ' (', .),\n           pollutant_IQR = x_iqr) %>% \n    mutate(result = gsub('000e\\\\+00', '', result)) %>% \n    select(predictor, term, pollutant_IQR, result, OR, CI_low, CI_high, p.value) \n  \n  return(clean_fit)\n}\n\nfit_longterm_365 = purrr::map_df(\n  c(\"PM2.5_MA_365\", \"SO4_MA_365\", \"NO3_MA_365\", \n    \"NH4_MA_365\", \"OM_MA_365\", \"BC_MA_365\"), \n  fit_logistic)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPM2.5_MA_365\nSO4_MA_365\nNO3_MA_365\nNH4_MA_365\nOM_MA_365\nBC_MA_365\n```\n:::\n\n```{.r .cell-code}\nfit_longterm_365 %>% \n  filter(grepl('_MA_365', term))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  predictor    term         pollutant_IQR result       OR CI_low CI_high p.value\n  <chr>        <chr>                <dbl> <chr>     <dbl>  <dbl>   <dbl>   <dbl>\n1 PM2.5_MA_365 PM2.5_MA_365        15.0   1.042 (0…  1.04  0.902    1.20 5.76e-1\n2 SO4_MA_365   SO4_MA_365           2.65  1.317 (1…  1.32  1.14     1.52 1.82e-4\n3 NO3_MA_365   NO3_MA_365           3.51  1.135 (0…  1.14  0.974    1.32 1.04e-1\n4 NH4_MA_365   NH4_MA_365           2.00  1.016 (0…  1.02  0.877    1.18 8.31e-1\n5 OM_MA_365    OM_MA_365            3.61  1.187 (1…  1.19  1.03     1.37 1.78e-2\n6 BC_MA_365    BC_MA_365            0.637 1.148 (1…  1.15  1.02     1.30 2.50e-2\n```\n:::\n:::\n\n```\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}